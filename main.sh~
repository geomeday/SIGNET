#!/bin/bash


#!/bin/bash
export APP_PATH=/usr/local/SmartDataStack
operate=${1}
#echo "${0}"
APP_NAME="sds"

pid=$(ps -aef | grep sds- | grep -v grep | awk '{print $2}')
options=""
for((i=2;i<=$#;i++)); do 
    j=${!i}
    options="${options} $j "
done

startSDS(){

        if [ "$pid" == ""  ]; then
                echo -n "$APP_NAME starting: "

        for f in $APP_PATH/sds*.jar; do
            sudo chown root:root $f && sudo chmod 775 $f
        done

        if [ "$?" == 0 ]; then 
            sudo sh $APP_PATH/start.prod.sh                      

            if [ "$?" -eq 0 ]; then

                echo "launch done, next will copy upload directory to $APP_PATH/tmp/webapp"
                sleep 10
                sudo cp -R $APP_PATH/upload $APP_PATH/tmp/webapp
                echo -e ""
                echo "Success"
            else
                echo "failure"
            fi

        else
            echo "failure, 'chown' && 'chmod failure'"
            echo -e ""
            exit 1
        fi

    else 
        echo "can't start SDS: SDS is running."
        echo -e ""
        exit 1       
        fi
}

stopSDS() {

    if [ "$pid" == "" ]; then
        echo "can't stop SDS: SDS is not running."
        echo -e ""
        exit 1
    fi

    echo -n "$APP_NAME stoping[pid: $pid]: "   

    # first copy upload dir
    sudo cp -R $APP_PATH/tmp/webapp $APP_PATH/upload && sudo kill $pid  

    # sudo kill `ps -aef | grep sds- | grep -v grep | awk '{print $2}'`

    if [ "$?" == 0 ]; then 
        sleep 5
        echo "success"
    else
        echo "failure"
        echo  -e ""
        exit 1
    fi
}

restartSDS() {

    echo "$APP_NAME restart..."
    # stopSDS
        # startSDS
    $0 stop
    $0 start
}

statusSDS() {

    #echo "------------------------------------------"
    echo "      pid status  "
    echo "------------------------------"   

    if [ "$pid" == "" ]; then
        echo "$APP_NAME	$pid  stoped"
    else
        echo "$APP_NAME	$pid  started"
    fi


}

geno_prep(){
	./geno_prep_portal.sh ${options};
}




echo -e ""


case "$operate" in
    geno-prep)
        geno_prep 
        ;;
    gexp-prep)
        stopSDS
        ;;
    network)
        restartSDS
        ;;
    cis-eqtl)
        statusSDS
        ;;
    *)
        echo -e "Usage params: start|stop|status|restart|reload"
        ;;
esac        

echo -e ""

exit 0
????????????????
????????CSDN???BarackHusseinObama?????????CC 4.0 BY-SA?????????????????????
?????https://blog.csdn.net/t894690230/java/article/details/60147963
